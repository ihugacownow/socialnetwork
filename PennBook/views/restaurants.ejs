<!DOCTYPE html>
<html>
  <head><title>Map</title>
  <link rel="stylesheet" href="http://getbootstrap.com/dist/css/bootstrap.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style type="text/css">
    body {
      padding-top: 40px;
	  padding-bottom: 40px;
 	  background-color: white;
         }
    .login-box {
    max-width: 330px;
    margin: 0 auto;
   		}
    .login-box .form-control {
      margin-bottom: 10px;
    }
  </style>
 
  <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
  </script><script type="text/javascript">

	
  </script>
</head>

<body>
<!--   <div id="map" style="width:500px;height:500px;"></div>
 -->  
  <div id="pos"></div>
  <div id="dataFromServer"></div> 

<!-- Table Element 
	Da
 --> 

 <h1> Posts </h1>

<table border="1">
<% if (posts != null) { %> 
	<% for(var i=0; i < posts.length; i++) { %>
		<tr>
			<table border="1">
			Table starts here 
				<th>Person</th> <th>Post</th> 
				
				<!-- 		Create the post first -->	
		  		<% var post = posts[i];  %>
		  		<% var postVal = post['value'];  %>
		  		<br>	
			    <tr>
				     <td> <%=postVal['owner1'] %> </td>
				     <td> <%=postVal['text'] %> </td>
				</tr>
				
				<!-- 	   Then create the comments 		-->
		 		<br>
		 		Comments 
		 		<% var comments = postVal['commentTexts'];  %>
		 		<% var commentsOwner = postVal['commentOwners'];  %>

		 		<% for(var j=0; j < comments.length; j++) { %>	
		 			<tr>
			     		<td> <%=commentsOwner[j]%> </td>
			     		<td> <%=comments[j]%> </td>
			   		</tr>
		 		<% }  %>
		 		Table ends here 
		 	</table>			 		
		 		<!-- 	   Then create the add new post part		-->
	 		<br>
			<form id="addcomment" method="post">
		    <input type="text" id="commenttext" name="text" placeholder="Add comment" required> <br><br> 
		    <input id="submitButton" type="submit" value="Add" />
		  	</form>  			
		</tr>	
	<% } %>
<% } %> 
</table>

 




 <br> 
 
<!--  Add Posts Element 
 -->
 <br> 
 
 <h3> Add New Post  </h3>
 
  <form id="addpost" method="post">
    <input type="text" id="formLatitude" name="latField" placeholder="Enter Latitude" required> 
    <br>
    <input type="text" id="formLongitude" name="longField" placeholder="Enter longitude" required> 
    <br>
     <input type="text" name="nameField" placeholder="Enter Name" required>
    <br>
     <input type="text" name="descField" placeholder="Enter Description" required>
    <br>
    <p> </p>
   <br><br> 
    <input id="submitButton" type="submit" value="Add" />
  </form>  



  
  <script type="text/javascript">
 	// Store the default user on login
	var firstname = "";
	var lastname = "";
	var userID = "";


	// 1) Load Map Logic 	
	var loadUser= function() {	
		// TODO: Add users, first, last
	};	
	

	//4) Initialize functions onload 
	window.onload = function() {
		loadUser();
		// refreshMap();
  //     	setInterval(refreshMap, 5 * 1000);    
	
	};
	

	var refreshMap = function() {
	 	map = null;   	
    	 $.get('/getajaxrestaurants', function(response) 
           {
             loadMapAjax(JSON.parse(response))  
             
           })
           // in case there is an error 
           .fail(function(error) { alert(error.responseJSON) });            
    } 
    
   

	
	//----------------------------------------------------------------
  
  
  // Event Handling part of code -- 
  
  	// 1) Use a submit handler for the form
  
	$( "#addcomment" ).submit(function( event ) {
	   // stop the form from submitting and refreshing
        event.preventDefault();
        event.stopPropagation();
        
 		var formData = {
	 			'text'	: $('input[name=latField]').val(), 
	 			'owner'	: $('input[name=longField]').val(),
	 			'firstname' : firstname, 
	 			 'lastname' : lastname, 
	 			 'postID'   : 
 				};  		
 		
 		var commentData = JSON.stringify(formData);
 		
 	// 2) process the form with ajax 
 	
 		 $.post('/ajaxrestaurant', formData, function(response) 
           {
            // Add new marker based on data returned from the server 
            addNewMarker(JSON.parse(response))           
           })
           // in case there is an error 
           .fail(function(error) { alert(error.responseJSON) });  
    	});	



  
  </script>
  
  <br>
  <a href= "/logout"> Click to Log Out </a>  
  
</body>
</html>


console.log("About to query!");
      setTimeout(db.query(params, function(err, data) {
        console.log("finished querying!");
        if (err || data.Items.length == 0) {
          console.log("ERROR??: " + err);
          callback(err, null);
        } else {
            var items = [];
            console.log("number of items: " + data.Items.length);

            for (var i = 0; i < data.Items.length; i++) {
              items.push({"inx": data.Items[i].inx.N, "value": data.Items[i].value.S});
            }

            self.cache.set(search, items);
            console.log("about to call the db callback!");
            callback(err, items);
        }
      }), 2000);






